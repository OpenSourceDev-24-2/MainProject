<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard | Klorofil - Free Bootstrap Dashboard Template</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta
          name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
  />
  <!-- VENDOR CSS -->
  <link
          rel="stylesheet"
          href="assets/vendor/bootstrap/css/bootstrap.min.css"
  />
  <link
          rel="stylesheet"
          href="assets/vendor/font-awesome/css/font-awesome.min.css"
  />
  <link rel="stylesheet" href="assets/vendor/linearicons/style.css" />
  <link
          rel="stylesheet"
          href="assets/vendor/chartist/css/chartist-custom.css"
  />
  <!-- MAIN CSS -->
  <link rel="stylesheet" href="assets/css/main.css" />
  <!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
  <link rel="stylesheet" href="assets/css/demo.css" />
  <!-- GOOGLE FONTS -->
  <link
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700"
          rel="stylesheet"
  />
  <!-- ICONS -->
  <link
          rel="apple-touch-icon"
          sizes="76x76"
          href="assets/img/apple-icon.png"
  />
  <link
          rel="icon"
          type="image/png"
          sizes="96x96"
          href="assets/img/favicon.png"
  />
  <style>
    .pagination-buttons {
      display: flex; /* Flexbox 사용 */
      justify-content: center; /* 버튼을 가로 중앙으로 정렬 */
      margin-top: 20px; /* 버튼과 테이블 사이의 여백 */
      margin: 0 10px; /* 버튼 간격 */
    }
    .create-question-btn {
      margin-bottom: 20px; /* 게시글 작성 버튼의 여백 */
    }
  </style>
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
  <!-- NAVBAR -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="brand">
      <a href="../index.html"
      ><img src="" alt="회사 로고" class="img-responsive logo"
      /></a>
    </div>
    <div class="container-fluid">
      <div class="navbar-btn">
        <button type="button" class="btn-toggle-fullwidth">
          <i class="lnr lnr-arrow-left-circle"></i>
        </button>
      </div>
      <form class="navbar-form navbar-left"></form>
      <div id="navbar-menu">
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a
                    href="#"
                    class="dropdown-toggle icon-menu"
                    data-toggle="dropdown"
            >
              <i class="lnr lnr-alarm"></i>
              <span class="badge bg-danger">5</span>
            </a>
            <ul class="dropdown-menu notifications">
              <li>
                <a href="#" class="notification-item"
                ><span class="dot bg-warning"></span>System space is
                  almost full</a
                >
              </li>
              <li>
                <a href="#" class="notification-item"
                ><span class="dot bg-danger"></span>You have 9 unfinished
                  tasks</a
                >
              </li>
              <li>
                <a href="#" class="notification-item"
                ><span class="dot bg-success"></span>Monthly report is
                  available</a
                >
              </li>
              <li>
                <a href="#" class="notification-item"
                ><span class="dot bg-warning"></span>Weekly meeting in 1
                  hour</a
                >
              </li>
              <li>
                <a href="#" class="notification-item"
                ><span class="dot bg-success"></span>Your request has been
                  approved</a
                >
              </li>
              <li><a href="#" class="more">See all notifications</a></li>
            </ul>
          </li>

          <!-- 우측 상단의 사용자 정보 부분 수정 -->
          <li class="dropdown">
            <a
                    href="#"
                    class="dropdown-toggle"
                    data-toggle="dropdown"
                    id="user-info-link"
            >
              <img
                      src="assets/img/user.png"
                      class="img-circle"
                      alt="Avatar"
              />
              <span id="username-display">Unknown</span>
              <i class="icon-submenu lnr lnr-chevron-down"></i>
            </a>
            <ul class="dropdown-menu">
              <li>
                <a href="page-profile.html"
                ><i class="lnr lnr-user"></i> <span>My Profile</span></a
                >
              </li>
              <li>
                <a href="#"
                ><i class="lnr lnr-envelope"></i> <span>Message</span></a
                >
              </li>
              <li>
                <a href="#"
                ><i class="lnr lnr-cog"></i> <span>Settings</span></a
                >
              </li>
            </ul>
          </li>
          <li style="display: inline-block; margin-left: 10px">
            <a
                    href="#"
                    id="logout-btn"
                    style="
                    color: #000000;
                    font-weight: bold;
                    text-decoration: none;
                  "
            >로그아웃</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END NAVBAR -->

  <!-- LEFT SIDEBAR -->
  <div id="sidebar-nav" class="sidebar">
    <div class="sidebar-scroll">
      <nav>
        <ul class="nav">
          <li>
            <a href="mainboard.html" class="active"
            ><i class="lnr lnr-home"></i> <span>전체 게시판</span></a
            >
          </li>
          <li>
            <a href="reviewboard.html" class=""
            ><i class="lnr lnr-code"></i> <span>시설리뷰 게시판</span></a
            >
          </li>
          <li>
            <a href="eventsboard.html" class=""
            ><i class="lnr lnr-chart-bars"></i>
              <span>봉사/행사 게시판</span></a
            >
          </li>
          <li>
            <a href="promotionboard.html" class=""
            ><i class="lnr lnr-cog"></i> <span>홍보 게시판</span></a
            >
          </li>
          <li>
            <a href="#subPages" data-toggle="collapse" class="collapsed"
            ><i class="lnr lnr-file-empty"></i> <span>Pages</span>
              <i class="icon-submenu lnr lnr-chevron-left"></i
              ></a>
            <div id="subPages" class="collapse">
              <ul class="nav">
                <li><a href="page-profile.html" class="">Profile</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- END LEFT SIDEBAR -->

  <!-- MAIN -->
  <div class="main">
    <!-- MAIN CONTENT -->
    <div class="main-content">
      <div class="container-fluid">
        <h3 class="page-title">전체 게시판</h3>

        <!-- 게시글 작성 버튼 -->
        <div class="create-question-btn">
          <button id="create-question-btn" class="btn btn-primary">
            게시글 작성
          </button>
        </div>

        <!-- 검색창 영역 -->
        <div class="input-group" style="margin-bottom: 20px">
          <input
                  type="text"
                  value=""
                  class="form-control"
                  placeholder="검색어를 입력하세요..."
          />
          <span class="input-group-btn">
                <button type="button" class="btn btn-primary">Go</button>
              </span>
        </div>

        <!-- 테이블 영역 -->
        <div class="row">
          <div class="col-md-12">
            <!-- TABLE STRIPED -->
            <div class="panel">
              <div class="panel-heading">
                <h3 class="panel-title">공지사항</h3>
              </div>
              <div class="panel-body table-responsive">
                <table
                        class="table table-striped table-bordered"
                        style="width: 100%"
                >
                  <style>
                    td:not(:nth-child(1)) {
                      text-align: center;
                    }
                  </style>
                  <thead>
                  <tr>
                    <th style="width: 71%; text-align: center">제목</th>
                    <th style="width: 7%; text-align: center">추천수</th>
                    <th style="width: 10%; text-align: center">작성자</th>
                    <th style="width: 12%; text-align: center">
                      작성 일시
                    </th>
                  </tr>
                  </thead>
                  <tbody id="question-list">
                  <!-- 질문 데이터가 동적으로 추가됩니다 -->
                  </tbody>
                </table>

                <!-- 페이지네이션 버튼 -->
                <div class="pagination-buttons">
                  <button id="prev-page" class="btn btn-primary">
                    이전
                  </button>
                  <button id="next-page" class="btn btn-primary">
                    다음
                  </button>
                </div>
              </div>
            </div>
            <!-- END TABLE STRIPED -->
          </div>
        </div>
      </div>
    </div>
    <!-- END MAIN CONTENT -->
  </div>
  <!-- END MAIN -->
</div>
<!-- END WRAPPER -->

<!-- Javascript -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script>
  // 게시글 작성 버튼 클릭 이벤트
  document
          .getElementById("create-question-btn")
          .addEventListener("click", function () {
            window.location.href = "question_form.html"; // 게시글 작성 페이지로 이동
          });
</script>

<!-- 수정된 JavaScript -->
<script>
  let currentPage = 0; // 현재 페이지 번호

  // 날짜 형식을 "YYYY-MM-DD HH:MM"으로 변환하는 함수
  function formatDate(createDate) {
    const date = new Date(createDate);

    if (isNaN(date.getTime())) { // 날짜가 유효한지 확인
      console.error("Unexpected date format:", createDate);
      return createDate; // 원본 날짜 반환
    }

    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 +1
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');

    return `${year}-${month}-${day} ${hours}:${minutes}`;
  }

  // 데이터를 로드하는 함수
  function loadQuestions(page) {
    fetch(`http://localhost:8080/api/questions?page=${page}`)
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              console.log("API response data:", data); // 디버깅 로그

              const tableBody = document.getElementById("question-list");
              tableBody.innerHTML = ""; // 기존 데이터를 초기화

              if (!data.content || !Array.isArray(data.content)) {
                console.error("Unexpected data structure:", data);
                return;
              }

              // 테이블에 질문 데이터를 추가
              data.content.forEach((question) => {
                const row = document.createElement("tr");

                // 각 필드가 존재하는지 확인
                if (!question.subject || question.recommendCount == null || !question.createDate) {
                  console.warn("Incomplete question data:", question);
                }

                row.innerHTML = `
                <td><a href="question-detail.html?id=${question.id}">${question.subject || 'No Subject'}</a></td>
                <td>${question.recommendCount != null ? question.recommendCount : '0'}</td>
                <td>${question.author ? question.author.username : "익명"}</td>
                <td>${formatDate(question.createDate)}</td>
              `;
                tableBody.appendChild(row);
              });

              // 현재 페이지 번호 업데이트
              currentPage = page;

              // 이전 버튼 활성화/비활성화
              document.getElementById("prev-page").disabled = currentPage === 0;

              // 다음 버튼 활성화/비활성화 (마지막 페이지 체크)
              document.getElementById("next-page").disabled = data.last || false;
            })
            .catch((error) => {
              console.error("Error loading questions:", error);
              // 사용자에게 에러 메시지를 표시할 수 있음
            });
  }

  // 이전 페이지 버튼 클릭 이벤트
  document.getElementById("prev-page").addEventListener("click", () => {
    if (currentPage > 0) {
      loadQuestions(currentPage - 1);
    }
  });

  // 다음 페이지 버튼 클릭 이벤트
  document.getElementById("next-page").addEventListener("click", () => {
    loadQuestions(currentPage + 1);
  });

  // 초기 로드
  loadQuestions(0);
</script>

<script>
  // 로컬 저장소에서 로그인된 사용자 정보 가져오기
  const username = sessionStorage.getItem("username");

  if (username) {
    // 로그인 상태일 경우 사용자 이름을 표시
    document.getElementById("username-display").textContent = username;

    // 로그아웃 버튼 클릭 이벤트 추가
    document.getElementById("logout-btn").addEventListener("click", () => {
      sessionStorage.removeItem("username"); // 로컬 저장소에서 사용자 정보 제거
      window.location.href = "../index.html"; // 로그아웃 후 메인 페이지로 리다이렉트
    });
  } else {
    // 비로그인 상태일 경우 사용자 이름을 "Unknown"으로 표시
    document.getElementById("username-display").textContent = "Unknown";

    // 로그아웃 버튼의 텍스트를 "로그인"으로 설정
    const loginBtn = document.getElementById("logout-btn");
    loginBtn.textContent = "로그인";

    // 로그인 버튼 클릭 시 현재 URL을 저장하고 로그인 페이지로 이동
    document.getElementById("logout-btn").addEventListener("click", () => {
      // 현재 페이지 URL 저장
      sessionStorage.setItem("previousPage", window.location.href);

      // 로그인 페이지로 이동
      window.location.href = "/board/page-login.html";
    });
  }
</script>
</body>
</html>
